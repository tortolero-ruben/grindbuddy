FROM node:20-alpine

WORKDIR /app

# Enable corepack for pnpm
ENV PNPM_HOME="/pnpm"
ENV PATH="$PNPM_HOME:$PATH"
RUN corepack enable
RUN pnpm add -g turbo

# Copy monorepo workspace configs
COPY pnpm-lock.yaml pnpm-workspace.yaml package.json turbo.json .npmrc ./

# Copy package.json files
COPY apps/grind-buddy/package.json apps/grind-buddy/
COPY packages/auth/package.json packages/auth/
COPY packages/db/package.json packages/db/

# Install dependencies
RUN pnpm install --frozen-lockfile

# Expose port
EXPOSE 5173

# Start dev server
CMD ["pnpm", "run", "dev", "--filter", "grind-buddy"]
